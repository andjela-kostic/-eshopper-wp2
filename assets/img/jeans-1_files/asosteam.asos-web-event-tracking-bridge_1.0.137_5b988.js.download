(window.sharedJsonP=window.sharedJsonP||[]).push([["asosteam.asos-web-event-tracking-bridge|1.0.137|5b988"],{"5613a":function(e,t,r){"use strict";r.r(t),r.d(t,"initialise",(function(){return k}));var n=r("7a7d3"),a=r("ada85");function o(e,t,r,n,a,o,i){try{var u=e[o](i),s=u.value}catch(e){return void r(e)}u.done?t(s):Promise.resolve(s).then(n,a)}function i(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var i=e.apply(t,r);function u(e){o(i,n,a,u,s,"next",e)}function s(e){o(i,n,a,u,s,"throw",e)}u(void 0)}))}}var u=e=>{var{newrelicDelegate:t=(()=>{})}=e;return(function(){var e=i((function*(e){var r,n,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{n=yield t()}catch(e){return}if(null!==(r=n)&&void 0!==r&&r.noticeError){for(var[o,i]of Object.entries(a))"object"==typeof i&&(a[o]=JSON.stringify(i));return a.id="asos-web-event-tracking-bridge",n.noticeError(e,a)}}));return function(t){return e.apply(this,arguments)}}())},s=function(){var e=i((function*(e){var t,{port1:r,port2:n}=new MessageChannel;try{t=yield e()}catch(e){return null}return t.registerPreTrackCallback(()=>{var e={};for(var[n,a]of Object.entries(t))"string"!=typeof a&&"number"!=typeof a||(e[n]=a);e.events=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e.split(",").map(e=>e.split("=")[0]).filter(Boolean)}(e.events),r.postMessage(e)}),n}));return function(t){return e.apply(this,arguments)}}(),c=function(){var e=i((function*(e){if(!e)return null;var t;try{t=yield e()}catch(e){return null}var{port1:r,port2:n}=new MessageChannel;return t.addWildcardListener((e,t)=>{try{r.postMessage({events:[e],data:t})}catch(e){}}),n}));return function(t){return e.apply(this,arguments)}}(),v=function(){var e=i((function*(e){var{adobeDelegate:t,eventBusDelegate:r}=e;return[yield s(t),yield c(r)].filter(Boolean)}));return function(t){return e.apply(this,arguments)}}();var l={event1:{eventKey:"View Product Page",eventTags:{eVar60:{key:"eVar60"}}},event3:{eventKey:"Successful Search",eventTags:{searchTerm:{key:"eVar25"}}},event5:{eventKey:"Refinement",eventTags:{choice:{key:"prop13"}}},event43:{eventKey:"Product View",eventTags:{stockStatus:"In Stock"}},event10:{eventKey:"Add To Saved",eventTags:{productID:{key:"products"},eVar60:{key:"eVar60"}}},event44:{eventKey:"Product View",eventTags:{stockStatus:"Out Of Stock"}},event45:{eventKey:"Product View",eventTags:{stockStatus:"Partially Out Of Stock"}},event170:{eventKey:"View PLP Page",eventTags:{}},purchase:{eventKey:"OrderComplete-BR",eventTags:{orderID:{key:"purchaseID"},revenue:{key:"event36"},value:{key:"quantity"}}}},f=(e,t,r)=>"object"==typeof e?"revenue"===r?parseInt(100*t[e.key]):t[e.key]:e,d=e=>function(){var t=i((function*(t){if(t.events){var r;try{r=yield e()}catch(e){return}var{success:n}=yield r.onReady();n&&t.events.forEach(e=>{var n=l[e];if(n){var{eventKey:a,eventTags:o}=n,i=((e,t)=>{var r={},n=Object.entries(e).map(e=>{var[r,n]=e;return[r,f(n,t,r)]});for(var[a,o]of n)r[a]=o;return r})(o,t);r.track(a,null,null,i)}})}}));return function(e){return t.apply(this,arguments)}}(),y={"tracking.pageData.ready":e=>{var{href:t,pathname:r,pageTitle:n,hostname:a,queryString:o,browseCurrency:i,browseCountry:u,floor:s,platform:c,referrer:v,env:l,affiliateId:f,isAuthenticated:d,customerId:y,firstTimeBuyer:g,geoCountry:p}=e;return{event:"pageData",href:t,pagePath:r,pageTitle:n,hostname:a,queryString:o,browseCurrency:i,browseCountry:u,channel:s,deviceType:c,referringUrl:v,env:l,marketingData:{affid:f},customerData:{isAuthenticated:d,customerId:y,firstTimeBuyer:g,geoIpCountryCode:p}}}},g=e=>{var{id:t,eventName:r,data:o,logError:i}=e;if(null==o||!o.event)return null;var{port:u}=Object(a.getChannel)();try{Object(n.handleEvent)(t,o),u.postMessage({eventName:r,data:o})}catch(e){i(e,{id:t,eventName:r,data:o})}},p=(e,t)=>e?function(){var r=i((function*(r){if(!r.events)return null;r.events.forEach(n=>{var a,o=y[n];o&&((a=r.data)&&!Array.isArray(a)&&"object"==typeof a)?g({id:e,eventName:n,data:o(r.data),logError:t}):n.startsWith("tracking.gtm.")&&g({id:e,eventName:n,data:r.data,logError:t})})}));return function(e){return r.apply(this,arguments)}}():null,h=function(){var e=i((function*(e){var{featuresDelegate:t,gtmId:r,logError:n}=e;return[yield d(t),yield p(r,n)].filter(Boolean)}));return function(t){return e.apply(this,arguments)}}(),m=e=>{var{sources:t,sinks:r,logError:n}=e;t.forEach(e=>{r.forEach(t=>{e.addEventListener("message",function(){var e=i((function*(e){try{yield t(e.data)}catch(t){n(t,{data:e.data})}}));return function(t){return e.apply(this,arguments)}}())}),e.start()})},k=function(){var e=i((function*(e){var{adobeDelegate:t,eventBusDelegate:r,featuresDelegate:n,gtmId:a,newrelicDelegate:o}=e,i=u({newrelicDelegate:o}),[s,c]=yield Promise.all([v({adobeDelegate:t,eventBusDelegate:r}),h({featuresDelegate:n,gtmId:a,logError:i})]);m({sources:s,sinks:c,logError:i})}));return function(t){return e.apply(this,arguments)}}()}}]);
//# sourceMappingURL=asosteam.asos-web-event-tracking-bridge~1.0.137~5b988.js.map